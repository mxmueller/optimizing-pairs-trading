<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<filter **>
  @type record_transformer
  enable_ruby true
  <record>
    EventType ${record['type'] || 'app_log'}
    Application trading
    Environment development
    Timestamp ${time.strftime('%Y-%m-%dT%H:%M:%S.%LZ')}
    Level ${record['level'].upcase rescue 'INFO'}
    Source ${record['source']}
    TraceId ${record['trace_id']}
    UserId ${record['user_id']}
    RequestPath ${record['path']}
    RequestMethod ${record['method']}
    StatusCode ${record['status_code']}
    Duration ${record['duration']}
  </record>
</filter>

<match trading.logs>
  @type seq
  host seq
  port 5341

  <buffer>
    @type memory
    flush_interval 1s
  </buffer>

  properties {
    "Application": "${record['Application']}",
    "Environment": "${record['Environment']}",
    "EventType": "${record['EventType']}",
    "Level": "${record['Level']}",
    "Source": "${record['Source']}",
    "TraceId": "${record['TraceId']}",
    "UserId": "${record['UserId']}",
    "RequestPath": "${record['RequestPath']}",
    "RequestMethod": "${record['RequestMethod']}",
    "StatusCode": "${record['StatusCode']}",
    "Duration": "${record['Duration']}"
  }
</match>